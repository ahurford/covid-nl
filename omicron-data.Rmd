---
title: "COVID-19 in Newfoundland and Labrador"
author: "Amy Hurford, Zahra Mohammadi, and Francis Anokye"
output:
  html_document: default
  word_document: default
  pdf_document: default
fontsize: 11pt
---
[Memorial University of Newfoundland and Labrador,](https://www.mun.ca/math/)
[University of Guelph,](https://mathstat.uoguelph.ca/)
[Canadian Network for Modelling Infectious Disease,](https://canmod.net/)
[Mathematics for Public Health,](http://www.fields.utoronto.ca/activities/public-health)
[One Health Modelling Network for Emerging Infections](https://www.yorku.ca/science/cdm/2021/04/09/ccdm-network-to-model-emerging-infectious-diseases-receives-2-5-million-in-federal-funding/)

```{r setup, include=FALSE}
require(ggplot2)
require(patchwork)
data <- read.csv('https://raw.githubusercontent.com/ahurford/covid-nl/master/NL.csv', fill=TRUE)
# Fix problems with non-reporting days manually
data[1,2:7] = data[1,2:7]/2
# Need to add in December 16
new1 = data[2,]
L = length(data[,1])
new1[1,1] = "2021-12-16"
new1[1,2:7] = new1[2:7]/2
data = rbind(data[1,],new1,data[2:L,])
data[3,2:7] = data[2,2:7]
data[11,2:7] = data[11,2:7]/3
L = length(data[,1])
new1[1,1] = "2021-12-25"
new1[1,2:8] = data[11,2:8]
new2 = new1
new2[1,1] = "2021-12-26"
data = rbind(data[1:10,],new1, new2,data[11:L,])
NL.data = data
L = length(data[,1])
data2 = data.frame(date = rep(data$date,4), cases = c(data$EH, data$CH, data$WH, data$LG), RHA = rep(c("Eastern", "Central", "Western", "Labrador-Grenfell"), each=L)) 
data3 = data.frame(date = rep(data$date,4), cases = 100000*c(data$EH/317664, data$CH/91201, data$WH/76608, data$LG/36069), RHA = rep(c("Eastern", "Central", "Western", "Labrador-Grenfell"), each=L)) 
T<-10
DT = function(){
mod = nls(val ~ a*exp(r*seq(1,T)), 
               start = list(a = 100, r = 0.2))
#CI = confint(mod, level=0.95)
#CI.lower = max(CI[2,1],0)
#CI.upper = CI[2,2]
lambda = unname(coef(mod)[2])
DT = c(round(log(2)/lambda,2), NA, NA)
}
val <- tail(data$EH,T)
DT.eastern = DT()
val <- tail(data$CH,T)
DT.central = DT()
val <- tail(data$WH,T)
DT.western = DT()
val <- tail(data$LG,T)
DT.labrador = DT()
val <- tail(data$LG+data$EH+data$CH+data$WH,T)
DT.NL = DT()
```

<div class="alert alert-info">

On this website we:

- visualize COVID-19 cases reported by [Newfoundland and Labrador (NL)](https://www.gov.nl.ca/releases/covid-19-news/);

- estimate the doubling time of reported cases; and

- predict hospitalizations and deaths.

The data begins on December 15, 2021, when the [first Omicron case](http://ntv.ca/province-confirms-first-case-of-omicron-variant-introduces-new-public-health-measures/) was reported in NL.

</div>

## Testing

[Eligibility for PCR testing](https://www.gov.nl.ca/releases/2022/health/0103n02/) changed in NL on January 3rd, 2022, such that anyone that is a close contact of a case and has symptoms of COVID-19, should consider themselves a positive case. In British Columbia (BC), people under 65 are discouraged from seeking PCR testing. The [BC Modelling Group](https://bccovid-19group.ca/post/2022-01-06-report/COVID19group-2022-01-06.pdf) estimates that the number of cases reported in BC would be 3.6 times higher without this change in testing.

Comparisons, graphs, and analysis of reported cases in NL before and after January 3rd, 2022, should be treated with caution as it is not known how much the changes in PCR testing have resulted in under-counting of COVID-19 cases after January 3rd.

## Reported cases

```{r, echo=FALSE, warning = FALSE}
g1=ggplot(data3, aes(x=date, y=cases, group = RHA)) +
geom_line(aes(color=RHA))+
geom_point(aes(color=RHA))+
  xlab("")+
  ylab("")+
  ggtitle("Reported cases per 100,000 people in each NL Regional Health Authority")+
  #ggtitle(paste("At entry: ", exp.on.entry,"days since exposure"))+
theme_classic()+
  theme(axis.text.x = element_text(angle = 90),legend.title = element_blank())

g=ggplot(data2, aes(x=date, y=cases, group = RHA)) +
geom_line(aes(color=RHA))+
geom_point(aes(color=RHA))+
  xlab("")+
  ylab("")+
  ggtitle("Reported cases by NL Regional Health Authority")+
  #ggtitle(paste("At entry: ", exp.on.entry,"days since exposure"))+
theme_classic()+
  theme(axis.text.x = element_text(angle = 90),legend.title = element_blank())
g
```

**Figure 1.** 

```{r,echo=F}
g1
```

**Figure 2.** 

## Doubling times

The doubling time is the days until the number of reported cases doubles (assuming exponential growth). Our doubling time calculations consider the number of reported cases over the last `r T` days.

**Newfoundland and Labrador: `r DT.NL[1]` days**

**Eastern Health: `r DT.eastern[1]` days** 

**Central Health: `r DT.central[1]` days** 

**Western Health: `r DT.western[1]` days** 

**Labrador-Grenfell Health: `r DT.labrador[1]` days** 

Fitting is performed using nonlinear least squares and do not account for the changes in PCR testing announced on [January 3](https://www.gov.nl.ca/releases/2022/health/0103n02/).

```{r, include=F, warning=FALSE}
 
# Assume 3 days hospitalized. Admissions - discharges
# Hospitalized within 14 days of specimen, take 7 as mean.
d = 3
UKh = (198348/815)
UKm = (198348/57)
ONh = (29594/75)
ONm = (29594/3)
NLh = 0.99*UKh
NLm = .1*ONm
UK.rate = (data$EH+data$LG+data$CH+data$WH)/UKh
UK.rate = cumsum(UK.rate)
UK.rate[4:L] = UK.rate[4:L] - UK.rate[1:(L-3)]
ON.rate = (data$EH+data$LG+data$CH+data$WH)/ONh
ON.rate = cumsum(ON.rate)
ON.rate[4:L] = ON.rate[4:L] - ON.rate[1:(L-3)]
NL.rate = (data$EH+data$LG+data$CH+data$WH)/NLh 
NL.rate = cumsum(NL.rate)
NL.rate[4:L] = NL.rate[4:L] - NL.rate[1:(L-3)]

UK.rate.ad = cumsum(data$EH+data$LG+data$CH+data$WH)/UKh
ON.rate.ad = cumsum(data$EH+data$LG+data$CH+data$WH)/ONh
NL.rate.ad = cumsum(data$EH+data$LG+data$CH+data$WH)/NLh

# 649834/57 - 5 days median time to death.
UK.rate.m = cumsum(data$EH+data$LG+data$CH+data$WH)/UKm
ON.rate.m = cumsum(data$EH+data$LG+data$CH+data$WH)/ONm
NL.rate.m = cumsum(data$EH+data$LG+data$CH+data$WH)/NLm
future.dates = tail(seq(from=as.Date(data$date[L], format = "%Y-%m-%d"), length.out = 8, by = "days"),-1)
days2 = c(tail(as.Date(data$date, format = "%Y-%m-%d"),-7),future.dates)
future.dates.5 = tail(seq(from=as.Date(data$date[L], format = "%Y-%m-%d"), length.out = 6, by = "days"),-1)
days3 = c(tail(as.Date(data$date, format = "%Y-%m-%d"),-5),future.dates.5)
NL.hosp = c(tail(NL.data$cum.hospital,-7), rep(NA,7))
NL.mort = c(tail(NL.data$cum.mort,-5), rep(NA,5))
data2 = data.frame(dates = rep(days2,3), occupancy = c(ON.rate,UK.rate,NL.rate), location = rep(c("ON", "UK", "NL"), each = L))
data3 = data.frame(dates = rep(days3,3), mortality = c(ON.rate.m, UK.rate.m,NL.rate.m), location = rep(c("ON", "UK", "NL"), each = length(days3)))
data4 = data.frame(dates = rep(days2,3), admission = c(UK.rate.ad, ON.rate.ad, NL.rate.ad),location = rep(c("ON", "UK", "NL"), each = L)) 
pointdata = data.frame(days2 = days2, hospital = NL.hosp)
pointdata2 = data.frame(days2 = days3, mortality = NL.mort)
```

```{r, include=FALSE, warning=FALSE}
g2=ggplot()+
geom_line(data=data2, aes(x=as.Date(dates), y=occupancy, group = location, color=location))+
  geom_point(data = pointdata, aes(x = days2, y = hospital))+
  geom_line(data = pointdata, aes(x = days2, y = hospital))+
  xlab("")+
  ylab("")+
  scale_x_date(date_breaks = "1 day", date_labels = "%d %b")+
  ggtitle("Projected and actual hospital occupancy")+
theme_classic()+
  theme(axis.text.x = element_text(angle = 90),legend.title = element_blank())

g2b=ggplot()+
geom_line(data=data4, aes(x=as.Date(dates), y=admission, group = location, color=location))+
  xlab("")+
  ylab("")+
  scale_x_date(date_breaks = "1 day", date_labels = "%d %b")+
  ggtitle("Projected cumulative hospitalizations since December 15, 2021")+
theme_classic()+
  theme(axis.text.x = element_text(angle = 90),legend.title = element_blank())

g3=ggplot()+
geom_line(data=data3, aes(x=as.Date(dates), y=mortality, group = location, color=location))+
  geom_point(data = pointdata2, aes(x = days2, y = mortality))+
  geom_line(data = pointdata2, aes(x = days2, y = mortality))+
  xlab("")+
  ylab("")+
  scale_x_date(date_breaks = "1 day", date_labels = "%d %b")+
  ggtitle("Projected and actual cumulative deaths since December 15, 2021")+
theme_classic()+
  theme(axis.text.x = element_text(angle = 90),legend.title = element_blank())
```

## Hospitalizations and deaths

We consider data from [United Kingdom Health Security Agency  (UKHSA)](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1044481/Technical-Briefing-31-Dec-2021-Omicron_severity_update.pdf) and [Public Health Ontario (PHO)](https://www.publichealthontario.ca/-/media/documents/ncov/epi/covid-19-epi-enhanced-estimates-omicron-severity-study.pdf?sc_lang=en) reports to understand the relationship between reported Omicron cases and the future number of hospitalizations and deaths.

The UKHSA study reports for confirmed Omicron cases: 198,348 cases, 815 hospital admissions (0.41%), and 57 deaths (0.03%) up until December 29, 2021. The PHO study reports for Omicron: 29,594 cases, 75 hospitalizations or deaths (0.25%), and 3 deaths (0.01%) from November 22 - December 17, 2021.

```{r, echo=FALSE,warning=FALSE}
g2
```

**Figure 3.** The black dots and lines are the number of people in hospital as reported by the NL [Public Advisories](https://www.gov.nl.ca/releases/covid-19-news/). We assume hospitalizations are lagged 7 days from cases and the length of stay in hospital is 3 days ([Maslo et al. 2021](https://jamanetwork.com/journals/jama/fullarticle/2787776)). Hospital occupancy when assuming the reported proportion of hospitalizations for Omicron cases in the UKHSA (blue) and PHO (green) studies. The calibration to the NL data (red) assumes `r round(100/NLh,2)`% of reported cases are hospitalized.

<!-- ```{r, echo=FALSE,warning=FALSE} -->
<!-- g2b -->
<!-- ``` -->

<!-- **Figure 4.** The reported proportion of hospitalizations for Omicron cases in the PHO and UKHSA studies are parameters that determine the lower and upper bounds of the grey shaded regions for projected cumulative number of hospitalizations since December 15th, 2021 in NL. In addition, we assume hospitalizations are lagged 7 days from cases. The NL Public Advisories do not report the number of new admissions or discharges, so these predictions of the cumulative number of hospitalizations cannot be evaluated using the publicly available information. The range of cumulative hospitalization is [`r round(ON.rate.ad[(L-7)],2)`, `r round(UK.rate.ad[(L-7)],2)`] on `r as.Date(days2[(L-7)], format = "%d %b")` and [`r round(ON.rate.ad[L],2)`, `r round(UK.rate.ad[L],2)`] on `r as.Date(days2[L], format= "%d %b")`. -->


```{r, echo=FALSE,warning=FALSE}
g3
```

**Figure 4.** The black dots and lines are the number of deaths as reported by the NL [Public Advisories](https://www.gov.nl.ca/releases/covid-19-news/). We assume the time from being reported as a case to death is 5 days, which is the median time from specimen to death in the UKHSA study. Cumulative deaths since December 15, 2021 when assuming the reported proportion of deaths for Omicron cases in the UKHSA (blue) and PHO (green) studies. The calibration to the NL data (red) assumes that death occurs for `r round(100/NLm,2)`% of reported cases.


